도커는 왜 컨테이너마다 다른 OS가 가능할까?
vm도 아닌것이 
그럼 그 os들은 VM처럼 다 각자 깔리까?
머 저건 굳이 따지자면
우리가 일일이 인터넷에서 jar 받아다 
lib 폴더에 넣고 
빌드패스 잡아주고
컴파일 돌려도 되는데
pom.xml에 왜 라이브러리명을 넣고 돌릴까?
편해서 
그리고 pom.xml만 공유하면 
같은 라이브러리 구성은 어디서 빌드해도 가져갈 수 있으니까
도커가 왜 그렇냐는 말은 리눅스 커널의 cgroup이나 
namespace이야기부터 시작해야 하지만 제껴 
OS는 커널영역과 유저영역이 있음 
커널은 OS코어기능과 하드웨어를 제어하는 계층을 노출하는 역할을 하고 그 위에서 API를 가지고 굴러가는 프로그램들이 유저영역들에서 쎄쎄세 한다.
도커 컨테이너들은 기본적으로 자기 호스트머신의 커널 위에서 동작한다.
컨테이너안의 OS가 뭐든 커널은 자기가 깔린 머신의 커널이다.
커널 버전대로 OS버전도 결정된다 이뜻
그래서 
centos7에 우분투 18도커를 올려봐야 
우분투 18도커의 커널은 사실 센트 7 커널이다.
둘은 커널 버전이 다르지만은 
VM은 완성된 가상머신 인스턴스라면 
도커는 일단 한 OS의 커널안에서 그 OS가 제공하는 
namespace영역을 할당받아 동작한다.
그래서 도커는 한 머신에서 여러 컨테이너가 다른 OS를 쓸 수 있는거고 
그래서 사실 컨테이너마다 OS가 들어가야 하나?라고 하지만 
어차피 커널은 호스트꺼 한놈이다.
그렇지만 각 배포판마다 다른 툴이나 환경은 가지고 갈 수 있다.
그리고 이게 또 그렇게 비효율적이지도 않은게 
docker pull 할때 다운로드 받으면 프로그레스 보면 알겠지만
도커는 각 레이어별로 구성되어 있음 
그래서 동일한 베이스 위에서 올라가는 컨테이너는 하부 레이어를 재사용한다. 
예를 들어 ubuntu php/ ubuntu mysql 컨테이너를 두개 올린다면 커널은 호스트꺼 한 놈이고 우분투 배포판 환경도 두개가 어차피 우분투라 우분투 레이어는 재사용하고 
그 위에 php레이어와 mysql레이어가 각각 조합되서 컨테이너가 뜬다. 
그럼 도커 하나로 말아서 pom.xml 하나로 공유가능한 것처럼 쓰면 되겠군?
그래서 dockerfile만 공유하거나 dockerhub에서 pull 받아쓴다.
커널정보는 상속하더라도 커널영역과 유저영역이 구분되어 있다.
그럼 mysql이 돌아가려면 쉘도 필요하고 디렉토리 구조도 필요하다.

그러니깐 그 위의 OS는 OS커널이라기보단 그런 쉘이나 네크워크툴이나 기본디렉토리 구조인 거다.
yum이나 aptget같은 패키지 매니저나 설치관리자 이런거
그럼 그걸 왜 호스트껄 쓸 수 없냐? 할 수 있지만 
애초에 OS가 도커에 할당하는 공간은 격리된 빈깡통이다.

그러니까 거기에 쉘이랑 디렉토리구조랑 패키지랑 이런거 있어야함 그걸 호스트 껄 접근하면 사실 격리가 아님 

호스트 OS에 종속되서 이놈 환경 저놈환경에 따라 다르면 
도커의 사상과는 좀 안맞다.
물론 볼륨마운트 이런건 좀 제공한다. 
근데 그 환경을 호스트껄 전부 따오면 그냥 뭐 내 호스트에 
유저계정 따로 만들고 권한 준 홈디렉토리랑 별 차이가 없어보임

나중에 심심하면 cgroup이나 namespace 알아보길
리눅스 커멘드로 도커 비스무레한 격리스페이스 할당할 수 있다.
이게 공간만 할당하는게 아니라 CPU나 램사용제한이나 
네트워크 어댑터까지 격리해서 제공하고 관리하게 해줌

만약 그 os가 무거워보여 싫다면 알파인리눅스 베이스 이미지로 구하면 정말 베이스용량은 10메가도 안된다.

정말 완전 깡통 오브 깡통에 최소한만 넣어논 거라 

센트나 우분투 이미지는 못해도 백메가 정도는 할거다.
리눅스라는걸 이해해야 하는데 리눅스는 하나다

커널은 리눅스 토발즈 승인을 얻은 것만 직접 관리됨
그게 커널 2.6 3.1 4.0뭐 이런 커널이고 
센트 우분투 알파인 데비언 이런거는
패키지 매니저나 기본 기능이나 보안 파라미터나 이런걸 
각 회사들이 자기들이 나름 최적화해서 리눅스 커널위에 얹은 배포판이라고 하는 거다.

커널이 라면이면 배포판들은 토핑 얹어 파는거다.
참치라면이나 김치라면이나 전부 베이스는 신라면이라면요 
신라면이 커널이고 참치를 얹으면 센트 
김치를 얹으면 우분투 
